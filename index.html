<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>동창원 인수가이드</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root{
      --hanwha:#ff7f00;
      --hanwha-dark:#e67100;
      --bg:#f8f9fa;
      --card:#ffffff;
      --text:#333;
      --muted:#777;
      --border:#e6e6e6;
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:Arial,sans-serif;background:var(--bg);color:var(--text);}
    .screen{min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:2rem 1rem;}
    .app-title{font-size:24px;font-weight:700;color:var(--hanwha);margin-bottom:2rem;text-align:center;}
    .card{width:100%;max-width:520px;background:var(--card);border-radius:16px;box-shadow:0 6px 18px rgba(0,0,0,.08);padding:20px;}
    h2{margin:0 0 .75rem 0}
    .row{margin-bottom:.75rem}
    input{width:100%;padding:12px 14px;border:1px solid var(--border);border-radius:10px;font-size:16px;outline:none;}
    input:focus{border-color:var(--hanwha)}
    button{width:100%;padding:12px 14px;background:var(--hanwha);color:#fff;border:none;border-radius:10px;font-weight:700;cursor:pointer;font-size:16px;margin-bottom:8px;}
    button:hover{background:var(--hanwha-dark)}
    button.secondary{background:#6c757d;margin-bottom:0;}
    button.secondary:hover{background:#545b62}
    .hint{color:var(--muted); font-size:13px; margin-top:.25rem}
    .error{color:#d93025; font-size:14px; margin-top:.5rem}
    .success{color:#137333; font-size:13px}
    .container-narrow{max-width:760px}
    .results{margin-top:1rem}
    .result-card{background:#fff;border:1px solid var(--border);border-radius:14px;padding:16px;box-shadow:0 2px 8px rgba(0,0,0,.04);margin-bottom:12px;}
    .result-title{font-size:18px;font-weight:700;color:#222;margin-bottom:6px;}
    .result-sub{color:#444; margin:.25rem 0 .5rem 0}
    .info-table{width:100%;border-collapse:collapse;margin-top:.25rem;font-size:14px;}
    .info-table th,.info-table td{border:1px solid var(--border);padding:8px;text-align:center;white-space:nowrap;}
    .restrictions{margin-top:.5rem;padding:.5rem .75rem;background:#fafafa;border:1px dashed var(--border);border-radius:10px;font-size:14px;white-space:pre-line;}
    .meta{margin-top:.5rem;font-size:12px;color:var(--muted);text-align:center;}
    .install-prompt{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:var(--hanwha);color:white;padding:12px 20px;border-radius:25px;box-shadow:0 4px 12px rgba(0,0,0,.15);display:none;z-index:1000;cursor:pointer;font-weight:700;}
    .admin-btn{position:fixed;bottom:10px;right:10px;width:40px;height:40px;background:rgba(108,117,125,0.8);border-radius:50%;cursor:pointer;display:flex;align-items:center;justify-content:center;color:white;font-size:12px;font-weight:700;border:none;}
    .log-card{background:#fff;border:1px solid var(--border);border-radius:10px;padding:12px;margin-bottom:8px;font-size:14px;}
    .log-header{font-weight:700;color:var(--hanwha);margin-bottom:4px;}
    .log-time{color:var(--muted);font-size:12px;}
    .log-search{background:#f0f8ff;padding:4px 8px;border-radius:5px;margin-top:4px;font-family:monospace;}
  </style>
</head>
<body>
  <!-- 로그인 화면 -->
  <section id="loginScreen" class="screen">
    <div class="app-title">한화손보 동창원 SI 인수 가이드</div>
    <div class="card">
      <h2>로그인</h2>
      <div class="row">
        <input id="empno" type="text" placeholder="사번 입력" autocomplete="username" />
      </div>
      <div class="row">
        <input id="authCode" type="password" placeholder="인증번호 입력" autocomplete="current-password" />
        <div class="hint">관리자가 발급한 인증번호를 입력하세요.</div>
      </div>
      <button id="loginBtn">로그인</button>
      <div id="loginMsg" class="error" role="alert" aria-live="polite"></div>
    </div>
  </section>

  <!-- 검색 화면 -->
  <section id="searchScreen" class="screen" style="display:none;">
    <div class="app-title">한화손보 동창원 SI 인수 가이드</div>
    <div class="card container-narrow">
      <h2 style="margin-bottom:.5rem;">질병명 검색</h2>
      <div class="row">
        <input id="searchInput" type="text" placeholder="예시: 용종, 골절, 당뇨 등" />
      </div>
      <button id="searchBtn" title="검색">검색</button>
      <div class="results" id="results"></div>
    </div>
  </section>

  <!-- 관리자 로그 화면 -->
  <section id="adminScreen" class="screen" style="display:none;">
    <div class="app-title">관리자 로그 조회</div>
    <div class="card container-narrow">
      <h2>사용자 활동 로그</h2>
      <div class="row">
        <input id="adminPassword" type="password" placeholder="관리자 비밀번호를 입력하세요." />
      </div>
      <button id="loadLogsBtn">로그 불러오기</button>
      <button id="resetAuthBtn" class="secondary">사용자 인증 초기화</button>
      <div id="adminMsg" class="error"></div>
      <div class="meta" id="logStats"></div>
      <div id="logResults" class="results"></div>
    </div>
  </section>

<script>
// 샘플 데이터 (실제 서버에서는 fetch로 불러오기)
let employees = [
  { empno: "1001", authCode: "1111" },
  { empno: "1002", authCode: "2222" }
];
let diseases = [
  { name:"대장 용종", acceptance:"가능", signature355:"-", treatmentDays:"7", surgery:"없음", recurrence:"가능", restrictions:"없음" }
];
let currentUser = null;

// 토큰 기반 자동 로그인
const tokenKey = 'authToken';
function setToken(empno){ localStorage.setItem(tokenKey, empno); }
function getToken(){ return localStorage.getItem(tokenKey); }
function clearToken(empno){ localStorage.removeItem(tokenKey); if(currentUser===empno) currentUser=null; }

// 로그인 처리
function login(){
  const empno = document.getElementById("empno").value.trim();
  const authCode = document.getElementById("authCode").value.trim();
  const msg = document.getElementById("loginMsg");

  const user = employees.find(u => u.empno===empno && u.authCode===authCode);
  if(user){
    currentUser = empno;
    setToken(empno);
    showSearchScreen();
    msg.textContent="";
    saveLog(empno,'login');
  }else{
    msg.textContent="사번 또는 인증번호가 올바르지 않습니다.";
  }
}

// 자동 로그인
document.addEventListener('DOMContentLoaded', () => {
  const token = getToken();
  if(token){
    currentUser = token;
    showSearchScreen();
    saveLog(token,'auto-login');
  }
});

// 화면 전환
function showSearchScreen(){
  document.getElementById("loginScreen").style.display="none";
  document.getElementById("searchScreen").style.display="flex";
  document.getElementById("searchInput").focus();
}

// 검색
function normalize(str){ return String(str||"").toLowerCase().replace(/[\s·,\-\.]/g,""); }
function search(){
  if(!currentUser) return;
  const query = document.getElementById("searchInput").value.trim();
  const results = document.getElementById("results");
  if(!query){ results.innerHTML='<div class="hint">검색어를 입력하세요.</div>'; return; }
  saveLog(currentUser,'search',query);
  const tokens = query.split(/[\s·,\-\.]+/).filter(Boolean).map(normalize);
  const matched = diseases.filter(d => tokens.every(t=>normalize(d.name).includes(t)));
  if(!matched.length){ results.innerHTML='<div class="hint">검색 결과가 없습니다.</div>'; return; }
  results.innerHTML = matched.map(d=>`
    <div class="result-card">
      <div class="result-title">${d.name}</div>
      <div class="result-sub">인수기준: ${d.acceptance || "-"}</div>
      <div class="result-sub">시그니처355: ${d.signature355 || "-"}</div>
      <table class="info-table">
        <tr><th>치료일수</th><th>수술여부</th><th>재발여부</th></tr>
        <tr>
          <td>${d.treatmentDays||"-"}</td>
          <td>${d.surgery||"-"}</td>
          <td>${d.recurrence||"-"}</td>
        </tr>
      </table>
      <div class="restrictions">제한사항: ${d.restrictions || "없음"}</div>
    </div>
  `).join('');
}

// 로그 기록 (실제 서버 연동 필요)
function saveLog(empno, action, details=''){
  const log = { empno, action, details, timestamp:new Date().toISOString(), date:new Date().toLocaleString('ko-KR') };
  console.log('로그 저장 (서버 전송 필요):', log);
  // 예: fetch('/log',{method:'POST',body:JSON.stringify(log)});
}

// 관리자 화면 (샘플)
document.getElementById('adminBtn')?.addEventListener('click',()=>{
  document.getElementById('loginScreen').style.display='none';
  document.getElementById('searchScreen').style.display='none';
  document.getElementById('adminScreen').style.display='flex';
});

// 관리자 초기화
document.getElementById('resetAuthBtn')?.addEventListener('click',()=>{
  const empno = prompt("초기화할 사번 입력:");
  if(empno) clearToken(empno);
  alert(empno+' 인증이 초기화되었습니다.');
});

// 검색 버튼 이벤트
document.getElementById('searchBtn')?.addEventListener('click',search);
document.getElementById('searchInput')?.addEventListener('keydown',e=>{if(e.key==='Enter') search();});

// 로그인 버튼 이벤트
document.getElementById('loginBtn')?.addEventListener('click',login);
document.getElementById('empno')?.addEventListener('keydown',e=>{if(e.key==='Enter') login();});
document.getElementById('authCode')?.addEventListener('keydown',e=>{if(e.key==='Enter') login();});
</script>
</body>
</html>
