<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ìœ ë³‘ì ì¸ìˆ˜ê°€ì´ë“œ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root{
      --hanwha:#ff7f00;
      --hanwha-dark:#e67100;
      --bg:#f8f9fa;
      --card:#ffffff;
      --text:#333;
      --muted:#777;
      --border:#e6e6e6;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: Arial, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", sans-serif;
      background:var(--bg);
      color:var(--text);
    }
    .screen{
      min-height:100vh;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      padding:2rem 1rem;
    }
    .app-title{
      font-size:24px;
      font-weight:700;
      color:var(--hanwha);
      margin-bottom:2rem;
      text-align:center;
    }
    .card{
      width:100%;
      max-width:520px;
      background:var(--card);
      border-radius:16px;
      box-shadow:0 6px 18px rgba(0,0,0,.08);
      padding:20px;
    }
    h2{margin:0 0 .75rem 0}
    .row{margin-bottom:.75rem}
    input{
      width:100%;
      padding:12px 14px;
      border:1px solid var(--border);
      border-radius:10px;
      font-size:16px;
      outline:none;
    }
    input:focus{border-color:var(--hanwha)}
    button{
      width:100%;
      padding:12px 14px;
      background:var(--hanwha);
      color:#fff;
      border:none;
      border-radius:10px;
      font-weight:700;
      cursor:pointer;
      font-size:16px;
      margin-bottom:8px;
    }
    button:hover{background:var(--hanwha-dark)}
    button.secondary{
      background:#6c757d;
      margin-bottom:0;
    }
    button.secondary:hover{background:#545b62}
    button.reset{
      background:#dc3545;
      margin-top:8px;
    }
    button.reset:hover{background:#c82333}
    button.debug{
      background:#17a2b8;
      margin-bottom:8px;
    }
    button.debug:hover{background:#138496}
    button.logout{
      background:#28a745;
      margin-bottom:8px;
    }
    button.logout:hover{background:#218838}
    .hint{color:var(--muted); font-size:13px; margin-top:.25rem}
    .error{color:#d93025; font-size:14px; margin-top:.5rem}
    .success{color:#137333; font-size:13px}
    .debug{color:#17a2b8; font-size:12px; margin-top:.5rem; background:#f8f9fa; padding:8px; border-radius:5px; font-family:monospace; white-space:pre-wrap; max-height:200px; overflow-y:auto;}
    .container-narrow{max-width:760px}
    .results{margin-top:1rem}
    .result-card{
      background:#fff;
      border:1px solid var(--border);
      border-radius:14px;
      padding:16px;
      box-shadow:0 2px 8px rgba(0,0,0,.04);
      margin-bottom:12px;
    }
    .result-title{
      font-size:18px;
      font-weight:700;
      color:#222;
      margin-bottom:6px;
    }
    .result-sub{color:#444; margin:.25rem 0 .5rem 0}
    .info-table{
      width:100%;
      border-collapse:collapse;
      margin-top:.25rem;
      font-size:14px;
    }
    .info-table th,.info-table td{
      border:1px solid var(--border);
      padding:8px;
      text-align:center;
      white-space:nowrap;
    }
    .restrictions{
      margin-top:.5rem;
      padding:.5rem .75rem;
      background:#fafafa;
      border:1px dashed var(--border);
      border-radius:10px;
      font-size:14px;
      white-space:pre-line;
    }
    .meta{
      margin-top:.5rem;
      font-size:12px;
      color:var(--muted);
      text-align:center;
    }
    .user-info{
      position:fixed;
      top:10px;
      right:10px;
      background:rgba(255,127,0,0.1);
      padding:8px 12px;
      border-radius:20px;
      font-size:12px;
      color:var(--hanwha);
      font-weight:600;
      display:flex;
      align-items:center;
      gap:8px;
    }
    .user-info button{
      padding:4px 8px;
      font-size:11px;
      margin:0;
      width:auto;
      min-width:50px;
    }
    .loading{
      display:inline-block;
      animation:spin 1s linear infinite;
    }
    @keyframes spin{
      0%{transform:rotate(0deg);}
      100%{transform:rotate(360deg);}
    }
    
    /* ë³´í—˜íšŒì‚¬ ì—°ë½ì²˜ CSS */
    .insurance-section{
      margin-top:1.5rem;
    }
    .insurance-card.hanwha{
      background:#fff;
      border:3px solid var(--hanwha);
      border-radius:14px;
      padding:20px;
      box-shadow:0 4px 12px rgba(255,127,0,0.15);
      margin-bottom:16px;
      display:flex;
      align-items:center;
      gap:20px;
    }
    .insurance-grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
    }
    .insurance-card.small{
      background:#fff;
      border:1px solid var(--border);
      border-radius:12px;
      padding:12px;
      box-shadow:0 2px 6px rgba(0,0,0,.04);
      display:flex;
      flex-direction:column;
      align-items:center;
      text-align:center;
      min-height:130px;
    }
    .insurance-logo{
      width:120px;
      height:40px;
      object-fit:contain;
      flex-shrink:0;
      background:#f0f0f0;
      border-radius:8px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:12px;
      color:#666;
    }
    .insurance-logo.small{
      width:80px;
      height:30px;
      margin-bottom:8px;
      font-size:10px;
    }
    .insurance-info{
      flex:1;
    }
    .insurance-info.small{
      width:100%;
    }
    .insurance-contact{
      display:flex;
      gap:16px;
      flex-wrap:wrap;
      align-items:center;
    }
    .insurance-contact.small{
      flex-direction:column;
      gap:4px;
      align-items:center;
    }
    .contact-item{
      display:flex;
      align-items:center;
      gap:4px;
      font-size:14px;
    }
    .contact-item.small{
      font-size:11px;
      gap:2px;
    }
    .contact-item a{
      color:var(--hanwha);
      text-decoration:none;
      font-weight:600;
    }
    .contact-item a:hover{
      text-decoration:underline;
    }
    
    /* ì¹´í…Œê³ ë¦¬ ì œëª© ìŠ¤íƒ€ì¼ */
    .insurance-category h3{
      font-size:18px;
      font-weight:700;
      color:#333;
      margin:1.5rem 0 1rem 0;
      text-align:center;
      border-bottom:2px solid var(--hanwha);
      padding-bottom:8px;
    }
    
    @media (max-width: 768px) {
      .insurance-card.hanwha{
        flex-direction:column;
        align-items:flex-start;
        gap:12px;
      }
      /* ëª¨ë°”ì¼ì—ì„œë„ 2ì—´ ê·¸ë¦¬ë“œ ìœ ì§€ */
      .insurance-grid{
        grid-template-columns:1fr 1fr;
        gap:8px;
      }
      .insurance-contact{
        flex-direction:column;
        align-items:flex-start;
        gap:8px;
      }
      /* ëª¨ë°”ì¼ì—ì„œ í°íŠ¸ í¬ê¸° ì¡°ì • */
      .contact-item.small{
        font-size:10px;
      }
      .insurance-card.small{
        padding:8px;
        min-height:120px;
      }
      .insurance-logo.small{
        width:70px;
        height:25px;
      }
    }
  </style>
</head>
<body>
 <!-- ë¡œê·¸ì¸ í™”ë©´ -->
<section id="loginScreen" class="screen">
  <div class="app-title">í•œí™”ì†ë³´ ìœ ë³‘ì ì¸ìˆ˜ ê°€ì´ë“œ</div>
  <div class="card">
    <h2>ë¡œê·¸ì¸</h2>
    <div class="row">
      <input id="empno" type="text" placeholder="ì½”ë“œ ì…ë ¥" autocomplete="username">
    </div>
    <div class="row">
      <input id="password" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" autocomplete="current-password">
      <div class="hint">ì½”ë“œëŠ” ì‚¬ì „ ìŠ¹ì¸ëœ ê¸°ê´€ì— ë¶€ì—¬ë©ë‹ˆë‹¤.</div>
    </div>
    <button id="loginBtn">ë¡œê·¸ì¸</button>
    <button id="installBtn" class="secondary">í™ˆí™”ë©´ì— ì¶”ê°€</button>
    <div id="loginMsg" class="error" role="alert" aria-live="polite"></div>
    <div class="meta" id="empMeta"></div>
    <div class="meta" style="margin-top:1rem;">Copyright 2025 í•˜ì„¸ë´‰ all rights reserved.</div>
  </div>
</section>

<!-- ê²€ìƒ‰ í™”ë©´ -->
<section id="searchScreen" class="screen" style="display:none;">
  <div class="user-info" id="userInfo">
    <span id="userText"></span>
    <button id="logoutBtn" class="logout">ë¡œê·¸ì•„ì›ƒ</button>
  </div>
  <div class="app-title">í•œí™”ì†ë³´ ìœ ë³‘ì ì¸ìˆ˜ ê°€ì´ë“œ</div>
  <div class="card container-narrow">
    <h2 style="margin-bottom:.5rem;">ì§ˆë³‘ëª… ê²€ìƒ‰</h2>
    <div class="row">
      <input id="searchInput" type="text" placeholder="ì˜ˆì‹œ: ìš©ì¢…, ê³¨ì ˆ, ë‹¹ë‡¨ ë“±">
    </div>
    <button id="searchBtn" title="ê²€ìƒ‰">ê²€ìƒ‰</button>
    
    <!-- ë³´í—˜íšŒì‚¬ ì—°ë½ì²˜ ì„¹ì…˜ -->
    <div class="insurance-section">
      <div id="insuranceList"></div>
    </div>
    
    <div class="results" id="results"></div>
    <div class="meta" id="disMeta"></div>
    <div class="debug" id="debugInfo" style="display:none;"></div>
    <div class="meta" style="margin-top:1rem;">Copyright 2025 í•˜ì„¸ë´‰ all rights reserved.</div>
  </div>
</section>

<script>
// ì „ì—­ ë³€ìˆ˜
let employees = [];
let diseases = [];
let currentUser = null;
let isAdminUser = false;

// ë°ì´í„° URL
const EMP_URL = "https://raw.githubusercontent.com/bsens90-wq/hwg_main/main/data/employees.json";
const DIS_URL = "https://raw.githubusercontent.com/bsens90-wq/hwg_main/main/data/diseases.json";

// ê´€ë¦¬ì ê³„ì • ì •ë³´
const ADMIN_ACCOUNT = {
  empno: "8091768",
  password: "dcw8091"
};

// ë³´í—˜íšŒì‚¬ ë°ì´í„°
const INSURANCE_COMPANIES = [
  {
    "company": "í•œí™”ì†í•´ë³´í—˜",
    "callCenter": "1566-8000",
    "fax": "0502-779-1004",
    "termsUrl": "https://www.hwgeneralins.com/notice/ir/product-ing01.do"
  },
  {
    "company": "ì‚¼ì„±í™”ì¬",
    "callCenter": "1588-5114", 
    "fax": "0505-162-0872",
    "termsUrl": "https://www.samsungfire.com/vh/page/VH.HPIF0103.do"
  },
  {
    "company": "ë©”ë¦¬ì¸ í™”ì¬",
    "callCenter": "1566-7711", 
    "fax": "0505-021-3400",
    "termsUrl": "https://www.meritzfire.com/disclosure/product-announcement/product-list.do#!/"
  },
  {
    "company": "DBì†í•´ë³´í—˜",
    "callCenter": "1588-0100", 
    "fax": "0505-181-4862",
    "termsUrl": "https://www.idbins.com/FWMAIV1534.do"
  },
  {
    "company": "KBì†í•´ë³´í—˜",
    "callCenter": "1544-0114", 
    "fax": "0505-136-6500",
    "termsUrl": "https://www.kbinsure.co.kr/CG802030001.ec"
  },
  {
    "company": "í˜„ëŒ€í•´ìƒ",
    "callCenter": "1588-5656", 
    "fax": "0507-774-6060",
    "termsUrl": "https://www.hi.co.kr/serviceAction.do?view=bin/PA/03/HHPA03010M#none"
  },
  {
    "company": "ë¡¯ë°ì†í•´ë³´í—˜",
    "callCenter": "1588-3344", 
    "fax": "0507-333-9999",
    "termsUrl": "https://www.lotteins.co.kr/web/C/D/H/cdh190.jsp"
  },
  {
    "company": "í¥êµ­í™”ì¬",
    "callCenter": "1688-1688", 
    "fax": "0504-800-0700",
    "termsUrl": "https://www.heungkukfire.co.kr/FRW/announce/insGoodsGongsiSale.do"
  },
  {
    "company": "í•˜ë‚˜ì†í•´ë³´í—˜",
    "callCenter": "1566-3000", 
    "fax": "0505-170-0765",
    "termsUrl": "https://www.hanainsure.co.kr/w/disclosure/product/saleProduct"
  },
  {
    "company": "NHë†í˜‘ì†í•´ë³´í—˜",
    "callCenter": "1644-9000", 
    "fax": "0505-060-7000",
    "termsUrl": "https://www.nhfire.co.kr/announce/productAnnounce/retrieveInsuranceProductsAnnounce.nhfire"
  },
  {
    "company": "ë¼ì´ë‚˜ì†í•´ë³´í—˜",
    "callCenter": "1566-5800", 
    "fax": "ì½œì„¼í„° ì „í™” ì ‘ìˆ˜",
    "termsUrl": "https://www.lina.co.kr/disclosure/product-public-announcement/product-on-sales?key=0%3FproductState%3D01&productKind=01"
  },
  {
    "company": "AIGì†í•´ë³´í—˜",
    "callCenter": "1544-2792", 
    "fax": "02-2011-4607",
    "termsUrl": "https://www.aig.co.kr/wo/dpwot001.html?menuId=MS702"
  },
  {
    "company": "í•œí™”ìƒëª…",
    "callCenter": "1588-6363", 
    "fax": "ì½œì„¼í„° ì „í™” ì ‘ìˆ˜",
    "termsUrl": "https://www.hanwhalife.com/main/disclosure/goods/disclosurenotice/DF_GDDN000_P10000.do?MENU_ID1=DF_GDGL000"
  },
  {
    "company": "ë™ì–‘ìƒëª…",
    "callCenter": "1577-1004", 
    "fax": "02-3289-4516",
    "termsUrl": "https://pbano.myangel.co.kr/paging/WE_AC_WEPAAP020100L"
  },
  {
    "company": "êµë³´ìƒëª…",
    "callCenter": "1588-1001", 
    "fax": "ì½œì„¼í„° ì „í™” ì ‘ìˆ˜",
    "termsUrl": "https://www.kyobo.com/dgt/web/product-official/all-product/search"
  },
  {
    "company": "ì‚¼ì„±ìƒëª…",
    "callCenter": "1588-3114", 
    "fax": "ì½œì„¼í„° ì „í™” ì ‘ìˆ˜",
    "termsUrl": "https://www.samsunglife.com/individual/products/disclosure/sales/PDO-PRPRI010110M"
  },
  {
    "company": "ë¼ì´ë‚˜ìƒëª…",
    "callCenter": "1588-0058", 
    "fax": "02-6944-1200",
    "termsUrl": "https://www.lina.co.kr/disclosure/product-public-announcement/product-on-sales?key=0%3FproductState%3D01&productKind=01"
  },
  {
    "company": "KDBìƒëª…",
    "callCenter": "1588-4040", 
    "fax": "02-2669-6500",
    "termsUrl": "https://www.kdblife.co.kr/ajax.do?scrId=HDLMA002M02P"
  }
];

// ë³´í—˜íšŒì‚¬ ì—°ë½ì²˜ í‘œì‹œ
function showInsuranceContacts() {
  const insuranceList = document.getElementById("insuranceList");
  
  // ì„¹ì…˜ë³„ë¡œ ë¶„ë¥˜
  const damageInsurance = INSURANCE_COMPANIES.slice(1, 12); // ì†í•´ë³´í—˜ (í•œí™”ì†í•´ë³´í—˜ ì œì™¸)
  const lifeInsurance = INSURANCE_COMPANIES.slice(12); // ìƒëª…ë³´í—˜ 
  
  // í•œí™”ì†í•´ë³´í—˜ ì¹´ë“œ (íŠ¹ë³„ ë””ìì¸)
  const hanwhaCard = `
    <div class="insurance-card hanwha">
      <div class="insurance-logo">${INSURANCE_COMPANIES[0].company}</div>
      <div class="insurance-info">
        <div class="insurance-contact">
          <div class="contact-item">
            <span>ğŸ“</span>
            <a href="tel:${INSURANCE_COMPANIES[0].callCenter.replace(/-/g, '')}">${INSURANCE_COMPANIES[0].callCenter}</a>
          </div>
          <div class="contact-item">
            <span>ğŸ“ </span>
            <span>${INSURANCE_COMPANIES[0].fax}</span>
          </div>
          <div class="contact-item">
            <span>ğŸ”—</span>
            <a href="${INSURANCE_COMPANIES[0].termsUrl}" target="_blank" rel="noopener">ì•½ê´€í•¨</a>
          </div>
        </div>
      </div>
    </div>
  `;
  
  // ì¹´ë“œ ìƒì„± í•¨ìˆ˜
  function createCard(company) {
    const faxDisplay = company.fax === "ì½œì„¼í„° ì „í™” ì ‘ìˆ˜" ? "ì½œì„¼í„°ì ‘ìˆ˜" : company.fax;
    
    return `
      <div class="insurance-card small">
        <div class="insurance-logo small">${company.company}</div>
        <div class="insurance-info small">
          <div class="insurance-contact small">
            <div class="contact-item small">
              <span>ğŸ“</span>
              <a href="tel:${company.callCenter.replace(/-/g, '')}">${company.callCenter}</a>
            </div>
            <div class="contact-item small">
              <span>ğŸ“ </span>
              <span>${faxDisplay}</span>
            </div>
            <div class="contact-item small">
              <span>ğŸ”—</span>
              <a href="${company.termsUrl}" target="_blank" rel="noopener">ì•½ê´€í•¨</a>
            </div>
          </div>
        </div>
      </div>
    `;
  }
  
  // ê° ì„¹ì…˜ë³„ ì¹´ë“œë“¤ ìƒì„±
  const damageCards = damageInsurance.map(createCard).join('');
  const lifeCards = lifeInsurance.map(createCard).join('');
  
  // ì „ì²´ HTML êµ¬ì„±
  insuranceList.innerHTML = `
    ${hanwhaCard}
    <div class="insurance-category">
      <h3>ì†í•´ë³´í—˜</h3>
      <div class="insurance-grid">${damageCards}</div>
    </div>
    <div class="insurance-category">
      <h3>ìƒëª…ë³´í—˜</h3>
      <div class="insurance-grid">${lifeCards}</div>
    </div>
  `;
}

// ìë™ ë¡œê·¸ì¸ ì²´í¬
function checkAutoLogin() {
  const savedUser = localStorage.getItem('hwg_current_user');
  const savedIsAdmin = localStorage.getItem('hwg_is_admin') === 'true';
  
  if (savedUser) {
    currentUser = savedUser;
    isAdminUser = savedIsAdmin;
    showLoginSuccess();
  }
}

// ë¡œê·¸ì¸ ì„±ê³µ ì²˜ë¦¬
function showLoginSuccess() {
  document.getElementById("loginScreen").style.display = "none";
  document.getElementById("searchScreen").style.display = "flex";
  document.getElementById("userText").textContent = `ë¡œê·¸ì¸: ${currentUser}${isAdminUser ? ' (ê´€ë¦¬ì)' : ''}`;
  document.getElementById("searchInput").focus();
  
  // ë³´í—˜íšŒì‚¬ ì—°ë½ì²˜ í‘œì‹œ
  showInsuranceContacts();
}

// ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
function logout() {
  if (currentUser) {
    localStorage.removeItem('hwg_current_user');
    localStorage.removeItem('hwg_is_admin');
    currentUser = null;
    isAdminUser = false;
    
    document.getElementById("searchScreen").style.display = "none";
    document.getElementById("loginScreen").style.display = "flex";
    
    document.getElementById("empno").value = "";
    document.getElementById("password").value = "";
    document.getElementById("searchInput").value = "";
    document.getElementById("results").innerHTML = "";
  }
}

// JSON ë¡œë”
async function loadJsonFlexible(url){
  const res = await fetch(url + "?t=" + Date.now(), { cache: "no-store" });
  if(!res.ok) throw new Error("ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: " + res.status);
 
  const text = await res.text();
  const cleaned = text.replace(/^\uFEFF/, "");
  let json = JSON.parse(cleaned);

  if(json && typeof json === "object" && !Array.isArray(json) && Array.isArray(json.data)){
    json = json.data;
  }
  if(!Array.isArray(json)) throw new Error("JSONì´ ë°°ì—´ì´ ì•„ë‹™ë‹ˆë‹¤.");
 
  return json;
}

// ë°ì´í„° ë¡œë“œ
async function loadAllData(){
  try{
    const [emp, dis] = await Promise.all([
      loadJsonFlexible(EMP_URL),
      loadJsonFlexible(DIS_URL)
    ]);

    employees = emp.map(e => ({
      empno: String(e.empno || e.code || "").trim(),
      password: String(e.password || "").trim()
    })).filter(e => e.empno && e.password);

    diseases = dis.map(d => ({
      name: String(d.name || "").trim(),
      acceptance: String(d.acceptance || ""),
      signature355: String(d.signature355 || ""),
      treatmentDays: String(d.treatmentDays || ""),
      surgery: String(d.surgery || ""),
      recurrence: String(d.recurrence || ""),
      restrictions: String(d.restrictions || "")
    })).filter(d => d.name);

    document.getElementById("empMeta").textContent =
      `ìŠ¹ì¸ì‚¬ë²ˆ ${employees.length}ê±´ â€¢ ì§ˆë³‘ë°ì´í„° ${diseases.length}ê±´`;

  }catch(err){
    console.error("ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:", err);
    document.getElementById("loginMsg").textContent = "ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨";
  }
}

// ë¡œê·¸ì¸
function login(){
  const empno = document.getElementById("empno").value.trim();
  const password = document.getElementById("password").value.trim();
  const msg = document.getElementById("loginMsg");

  if(!empno || !password) {
    msg.textContent = "ì½”ë“œì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.";
    return;
  }

  // ê´€ë¦¬ì ê³„ì • í™•ì¸
  if (empno === ADMIN_ACCOUNT.empno && password === ADMIN_ACCOUNT.password) {
    currentUser = empno;
    isAdminUser = true;
    
    localStorage.setItem('hwg_current_user', empno);
    localStorage.setItem('hwg_is_admin', 'true');
    
    showLoginSuccess();
    msg.textContent = "";
    return;
  }

  if(!employees.length){
    msg.textContent = "ë°ì´í„°ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.";
    return;
  }

  const user = employees.find(u => u.empno === empno && u.password === password);
 
  if(user){
    currentUser = empno;
    isAdminUser = false;
    
    localStorage.setItem('hwg_current_user', empno);
    localStorage.removeItem('hwg_is_admin');
   
    showLoginSuccess();
    msg.textContent = "";
  }else{
    msg.textContent = "ì½”ë“œ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.";
  }
}

// ê²€ìƒ‰ ì •ê·œí™”
function normalize(str){
  return String(str || "").toLowerCase().replace(/[\sÂ·,\-\.]/g, "");
}

// ê²€ìƒ‰
function search(){
  const query = document.getElementById("searchInput").value.trim();
  const results = document.getElementById("results");
  const insuranceSection = document.querySelector(".insurance-section");
 
  if(!query){
    results.innerHTML = '<div class="hint">ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.</div>';
    insuranceSection.style.display = "block";
    return;
  }

  if(!diseases.length) {
    results.innerHTML = '<div class="error">ì§ˆë³‘ ë°ì´í„°ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</div>';
    insuranceSection.style.display = "block";
    return;
  }

  const tokens = query.split(/[\sÂ·,\-\.]+/).filter(Boolean).map(normalize);
 
  const matched = diseases.filter(d => {
    const name = normalize(d.name);
   
    if(tokens.every(token => name.includes(token))) {
      return true;
    }
   
    if(tokens.length === 1) {
      const token = tokens[0];
      if(token.length >= 3) {
        for(let i = 2; i <= token.length - 2; i++) {
          const left = token.substring(0, i);
          const right = token.substring(i);
         
          if(left.length >= 2 && right.length >= 2) {
            const leftPos = name.indexOf(left);
            const rightPos = name.indexOf(right);
           
            if(leftPos >= 0 && rightPos >= 0 && leftPos < rightPos) {
              return true;
            }
          }
        }
      }
    }
   
    return false;
  });

  if(!matched.length){
    results.innerHTML = '<div class="hint">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
    insuranceSection.style.display = "block";
    return;
  }

  // ê²€ìƒ‰ ê²°ê³¼ê°€ ìˆìœ¼ë©´ ë³´í—˜íšŒì‚¬ ë¦¬ìŠ¤íŠ¸ ìˆ¨ê¹€
  insuranceSection.style.display = "none";

  results.innerHTML = matched.map(d => `
    <div class="result-card">
      <div class="result-title">${d.name}</div>
      <div class="result-sub">ì¸ìˆ˜ê¸°ì¤€: ${d.acceptance || "-"}</div>
      <div class="result-sub">ì‹œê·¸ë‹ˆì²˜355: ${d.signature355 || "-"}</div>
      <table class="info-table">
        <tr><th>ì¹˜ë£Œì¼ìˆ˜</th><th>ìˆ˜ìˆ ì—¬ë¶€</th><th>ì¬ë°œì—¬ë¶€</th></tr>
        <tr>
          <td>${d.treatmentDays || "-"}</td>
          <td>${d.surgery || "-"}</td>
          <td>${d.recurrence || "-"}</td>
        </tr>
      </table>
      <div class="restrictions">ì œí•œì‚¬í•­: ${d.restrictions || "ì—†ìŒ"}</div>
    </div>
  `).join('');
}

// ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
document.addEventListener('DOMContentLoaded', () => {
  Promise.all([loadAllData()]).then(() => {
    checkAutoLogin();
  });
 
  document.getElementById('loginBtn').addEventListener('click', login);
  document.getElementById('empno').addEventListener('keydown', e => {
    if(e.key === 'Enter') {
      document.getElementById('password').focus();
    }
  });
  document.getElementById('password').addEventListener('keydown', e => {
    if(e.key === 'Enter') login();
  });

  document.getElementById('logoutBtn').addEventListener('click', logout);
 
  document.getElementById('searchBtn').addEventListener('click', search);
  document.getElementById('searchInput').addEventListener('keydown', e => {
    if(e.key === 'Enter') search();
  });
 
  document.getElementById('installBtn').addEventListener('click', () => {
    alert('ë¸Œë¼ìš°ì €ì—ì„œ í™ˆí™”ë©´ ì¶”ê°€ ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ì£¼ì„¸ìš”.');
  });
});
</script>

</body>
</html>
