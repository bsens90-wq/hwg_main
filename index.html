<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>유병자 인수가이드</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root{
      --hanwha:#ff7f00;
      --hanwha-dark:#e67100;
      --bg:#f8f9fa;
      --card:#ffffff;
      --text:#333;
      --muted:#777;
      --border:#e6e6e6;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      padding-top: 70px;
      font-family: Arial, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", sans-serif;
      background:var(--bg);
      color:var(--text);
    }
    
    .header-fixed {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      background: var(--bg);
      border-bottom: 2px solid #ccc;
      padding: 8px 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,.08);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .header-left {
      flex: 1;
    }
    
    .header-center {
      flex: 1;
      text-align: center;
    }
    
    .header-right {
      flex: 1;
      text-align: right;
    }
    
    .logo-container {
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-block;
    }
    
    .logo-container:hover {
      transform: scale(1.05);
    }
    
    .logo-main {
      font-size: 32px;
      font-weight: 900;
      color: var(--hanwha);
      letter-spacing: 3px;
      text-shadow: 0 2px 4px rgba(255,127,0,0.2);
      margin: 0;
      line-height: 1;
    }
    
    .logo-sub {
      font-size: 11px;
      color: var(--muted);
      font-weight: 400;
      margin-top: 2px;
      letter-spacing: 1px;
      opacity: 0.8;
    }
    
    .logo-container:hover .logo-main {
      color: var(--hanwha-dark);
      text-shadow: 0 4px 8px rgba(255,127,0,0.3);
    }
    
    .logo-container:hover .logo-sub {
      opacity: 1;
    }
    
    .user-info-header {
      background: rgba(255,127,0,0.1);
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      color: var(--hanwha);
      font-weight: 600;
      display: none;
      align-items: center;
      gap: 8px;
    }
    
    .user-info-header button {
      padding: 3px 8px;
      font-size: 11px;
      margin: 0;
      width: auto;
      min-width: 50px;
      background: #28a745;
      border-radius: 12px;
      border: none;
      color: white;
      cursor: pointer;
      font-weight: 600;
    }
    
    .user-info-header button:hover {
      background: #218838;
    }
    
    .screen{
      min-height:100vh;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      padding:2rem 1rem;
    }
    .app-title{
      font-size:24px;
      font-weight:700;
      color:var(--hanwha);
      margin-bottom:2rem;
      text-align:center;
    }
    .card{
      width:100%;
      max-width:520px;
      background:var(--card);
      border-radius:16px;
      box-shadow:0 6px 18px rgba(0,0,0,.08);
      padding:20px;
    }
    h2{margin:0 0 .75rem 0}
    .row{margin-bottom:.75rem}
    input, select{
      width:100%;
      padding:12px 14px;
      border:1px solid var(--border);
      border-radius:10px;
      font-size:16px;
      outline:none;
      background:#fff;
    }
    input:focus, select:focus{border-color:var(--hanwha)}
    button{
      width:100%;
      padding:12px 14px;
      background:var(--hanwha);
      color:#fff;
      border:none;
      border-radius:10px;
      font-weight:700;
      cursor:pointer;
      font-size:16px;
      margin-bottom:8px;
    }
    button:hover{background:var(--hanwha-dark)}
    button.secondary{
      background:#6c757d;
      margin-bottom:0;
    }
    button.secondary:hover{background:#545b62}
    button.logout{
      background:#28a745;
      margin-bottom:8px;
    }
    button.logout:hover{background:#218838}
    button.small{
      width:auto;
      padding:6px 12px;
      font-size:14px;
      margin:0 4px 0 0;
    }
    .hint{color:var(--muted); font-size:13px; margin-top:.25rem}
    .error{color:#d93025; font-size:14px; margin-top:.5rem}
    .container-narrow{max-width:760px}
    .container-wide{max-width:1200px}
    .results{margin-top:1rem}
    .result-card{
      background:#fff;
      border:1px solid var(--border);
      border-radius:14px;
      padding:16px;
      box-shadow:0 2px 8px rgba(0,0,0,.04);
      margin-bottom:12px;
    }
    .result-title{
      font-size:18px;
      font-weight:700;
      color:#222;
      margin-bottom:6px;
    }
    .result-sub{color:#444; margin:.25rem 0 .5rem 0}
    .info-table{
      width:100%;
      border-collapse:collapse;
      margin-top:.25rem;
      font-size:14px;
    }
    .info-table th,.info-table td{
      border:1px solid var(--border);
      padding:8px;
      text-align:center;
      white-space:nowrap;
    }
    .restrictions{
      margin-top:.5rem;
      padding:.5rem .75rem;
      background:#fafafa;
      border:1px dashed var(--border);
      border-radius:10px;
      font-size:14px;
      white-space:pre-line;
    }
    .meta{
      margin-top:.5rem;
      font-size:12px;
      color:var(--muted);
      text-align:center;
    }
    
    .insurance-section{
      margin-top:1.5rem;
    }
    .insurance-card.hanwha{
      background:#fff;
      border:3px solid var(--hanwha);
      border-radius:14px;
      padding:20px;
      box-shadow:0 4px 12px rgba(255,127,0,0.15);
      margin-bottom:16px;
      display:flex;
      align-items:center;
      gap:20px;
    }
    .insurance-grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
    }
    .insurance-card.small{
      background:#fff;
      border:1px solid var(--border);
      border-radius:12px;
      padding:12px;
      box-shadow:0 2px 6px rgba(0,0,0,.04);
      display:flex;
      flex-direction:column;
      align-items:center;
      text-align:center;
      min-height:130px;
    }
    .insurance-logo{
      width:120px;
      height:40px;
      object-fit:contain;
      flex-shrink:0;
      background:#f0f0f0;
      border-radius:8px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:16px;
      color:#333;
      font-weight:600;
    }
    .insurance-logo.small{
      width:80px;
      height:30px;
      margin-bottom:8px;
      font-size:12px;
    }
    .insurance-info{
      flex:1;
    }
    .insurance-info.small{
      width:100%;
    }
    .insurance-contact{
      display:flex;
      gap:16px;
      flex-wrap:wrap;
      align-items:center;
    }
    .insurance-contact.small{
      flex-direction:column;
      gap:4px;
      align-items:center;
    }
    .contact-item{
      display:flex;
      align-items:center;
      gap:8px;
      font-size:16px;
    }
    .contact-item.small{
      font-size:13px;
      gap:6px;
    }
    .contact-item a{
      color:var(--hanwha);
      text-decoration:none;
      font-weight:600;
    }
    .contact-item a:hover{
      text-decoration:underline;
    }
    
    .insurance-category h3{
      font-size:18px;
      font-weight:700;
      color:#333;
      margin:1.5rem 0 1rem 0;
      text-align:center;
      border-bottom:2px solid var(--hanwha);
      padding-bottom:8px;
    }

    /* 인수한도 기능 추가 스타일 - 개선된 틀고정 테이블 */
    .limit-table-container {
      position: relative;
      overflow: auto;
      border: 1px solid var(--border);
      border-radius: 8px;
      max-height: 70vh;
      background: white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .product-plan-header {
      position: sticky;
      top: 0;
      background: var(--hanwha);
      color: white;
      padding: 12px;
      text-align: center;
      font-size: 18px;
      font-weight: 700;
      z-index: 10;
      border-bottom: 2px solid var(--hanwha-dark);
    }
    
    .limit-table{
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      font-size: 16px;
      min-width: 800px;
    }
    
    .limit-table thead th {
      position: sticky;
      top: 60px;
      background: var(--bg);
      z-index: 5;
      border: 1px solid var(--border);
      padding: 12px 8px;
      text-align: center;
      font-weight: 700;
      font-size: 16px;
      white-space: nowrap;
    }
    
    .limit-table tbody td {
      border: 1px solid var(--border);
      padding: 12px 8px;
      text-align: center;
      vertical-align: middle;
      font-size: 16px;
    }
    
    .limit-table .coverage-name {
      position: sticky;
      left: 0;
      background: white;
      z-index: 3;
      text-align: left;
      font-weight: 600;
      min-width: 150px;
      max-width: 200px;
      word-break: break-word;
      border-right: 2px solid var(--hanwha);
    }
    
    .limit-table thead .coverage-name {
      z-index: 6;
      background: var(--bg);
    }
    
    .limit-table .age-group {
      min-width: 100px;
      font-size: 15px;
      font-weight: 600;
    }
    
    .limit-table .amount {
      font-weight: 700;
      color: var(--hanwha);
      min-width: 100px;
    }
    
    .limit-table .detail-btn {
      min-width: 80px;
    }

    /* 팝업 모달 */
    .modal{
      display:none;
      position:fixed;
      z-index:2000;
      left:0;
      top:0;
      width:100%;
      height:100%;
      background:rgba(0,0,0,0.5);
    }
    .modal-content{
      background:#fff;
      margin:5% auto;
      padding:20px;
      border-radius:16px;
      width:90%;
      max-width:700px;
      max-height:80vh;
      overflow-y:auto;
      position:relative;
    }
    .modal-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:1rem;
      padding-bottom:1rem;
      border-bottom:1px solid var(--border);
    }
    .modal-title{
      font-size:18px;
      font-weight:700;
      color:var(--text);
    }
    .close{
      color:#aaa;
      font-size:28px;
      font-weight:bold;
      cursor:pointer;
      line-height:1;
    }
    .close:hover{
      color:#000;
    }
    .modal-body{
      white-space:pre-line;
      line-height:1.6;
      color:var(--text);
      font-size:14px;
    }

    /* 로딩 스피너 */
    .loading-spinner {
      display: none;
      width: 40px;
      height: 40px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid var(--hanwha);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* 모바일 최적화 */
    @media (max-width: 768px) {
      .limit-table{
        font-size:14px;
        min-width: 600px;
      }
      .limit-table thead th {
        top: 50px;
        padding: 8px 4px;
        font-size: 14px;
      }
      .limit-table tbody td {
        padding: 8px 4px;
        font-size: 14px;
      }
      .limit-table .coverage-name{
        min-width:120px;
        max-width:150px;
        font-size:13px;
      }
      .limit-table .age-group{
        min-width:80px;
        font-size:12px;
      }
      .container-wide{
        max-width:100%;
        padding:0 10px;
      }
      .card{
        max-width:100%;
        margin:0 10px;
      }
      .product-plan-header {
        font-size: 16px;
        padding: 10px;
      }
    }
  </style>
</head>
<body>
  <div class="header-fixed">
    <div class="header-left"></div>
    <div class="header-center">
      <div class="logo-container" onclick="goHome()">
        <div class="logo-main">머드라</div>
        <div class="logo-sub">머드라.., 어딨드라..</div>
      </div>
    </div>
    <div class="header-right">
      <div id="userInfoHeader" class="user-info-header">
        <span id="userTextHeader"></span>
        <button id="logoutBtnHeader">로그아웃</button>
      </div>
    </div>
  </div>

  <!-- 로그인 화면 -->
  <section id="loginScreen" class="screen">
    <div class="loading-spinner" id="loadingSpinner"></div>
    <div id="loginContent">
      <div class="app-title">뭐더라..? 어딨더라..? 할 때?</div>
      <div class="card">
        <h2>로그인</h2>
        <div class="row">
          <input id="empno" type="text" placeholder="코드 입력" autocomplete="username">
        </div>
        <div class="row">
          <input id="password" type="password" placeholder="비밀번호 입력" autocomplete="current-password">
          <div class="hint">사전 승인된 기관만 로그인 가능합니다. </div>
        </div>
        <button id="loginBtn">로그인</button>
        <button id="installBtn" class="secondary">홈화면에 추가</button>
        <div id="loginMsg" class="error"></div>
        <div class="meta" id="empMeta"></div>
        <div class="meta" style="margin-top:1rem;">Copyright 2025 하세봉 all rights reserved.</div>
      </div>
    </div>
  </section>

  <!-- 메뉴 화면 -->
  <section id="menuScreen" class="screen" style="display:none;">
    <div class="app-title">뭐더라..? 어딨더라..? 할 때!</div>
    <div class="card">
      <h2 style="margin-bottom:1.5rem;">메뉴 선택</h2>
      
      <button id="diseaseMenuBtn" style="margin-bottom:1rem;">
        <span style="font-size:18px; display:block; margin-bottom:4px;">한화손보 SI 즉시 인수 질환</span>
      </button>
      
      <button id="contactMenuBtn" style="margin-bottom:1rem;">
        <span style="font-size:18px; display:block; margin-bottom:4px;">콜센터, 보험금 청구 팩스</span>
      </button>

      <button id="limitMenuBtn" style="margin-bottom:1rem;">
        <span style="font-size:18px; display:block; margin-bottom:4px;">상품별/플랜별 인수한도</span>
      </button>
      
      <div class="meta" style="margin-top:2rem;">Copyright 2025 하세봉 all rights reserved.</div>
    </div>
  </section>

  <!-- 검색 화면 -->
  <section id="searchScreen" class="screen" style="display:none;">
    <div class="app-title">한화손보 SI 즉시 인수 질환</div>
    <div class="card container-narrow">
      <h2 style="margin-bottom:.5rem;">질병명 검색</h2>
      <div class="row">
        <input id="searchInput" type="text" placeholder="예시: 용종, 골절, 당뇨 등">
      </div>
      <div id="searchMessage" class="hint" style="margin-bottom:1rem; display:none;"></div>
      
      <button id="searchBtn">검색</button>
      <button id="backBtn" class="secondary" style="display:none; margin-top:8px;">뒤로가기</button>
      
      <div class="results" id="results"></div>
      <div class="meta" style="margin-top:1rem;">Copyright 2025 하세봉 all rights reserved.</div>
    </div>
  </section>

  <!-- 연락처 화면 -->
  <section id="contactScreen" class="screen" style="display:none;">
    <div class="app-title">콜센터, 보험금 청구 팩스</div>
    <div class="card container-narrow">
      <div class="insurance-section">
        <div id="insuranceListContact"></div>
      </div>
      
      <div class="meta" style="margin-top:1rem;">Copyright 2025 하세봉 all rights reserved.</div>
    </div>
  </section>

  <!-- 인수한도 화면 -->
  <section id="limitScreen" class="screen" style="display:none;">
    <div class="app-title">상품별/플랜별 인수한도</div>
    <div class="card container-wide">
      <h2 style="margin-bottom:1rem;">상품 및 플랜 선택</h2>
      
      <div class="row">
        <select id="productSelect">
          <option value="">상품을 선택하세요</option>
        </select>
      </div>
      
      <div class="row">
        <select id="planSelect" disabled>
          <option value="">플랜을 선택하세요</option>
        </select>
      </div>
      
      <button id="limitSearchBtn" disabled>인수한도 조회</button>
      <button id="limitBackBtn" class="secondary" style="margin-top:8px;">뒤로가기</button>
      
      <div id="limitResults" class="results"></div>
      <div class="meta" style="margin-top:1rem;">Copyright 2025 하세봉 all rights reserved.</div>
    </div>
  </section>

  <!-- 상세조회 모달 -->
  <div id="noteModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">비고 상세조회</h3>
        <span class="close">&times;</span>
      </div>
      <div class="modal-body" id="noteModalBody"></div>
    </div>
  </div>

<script>
let employees = [];
let diseases = [];
let limitData = [];
let currentUser = null;
let isAdminUser = false;
let currentScreen = 'login';
const screenHistory = [];
let dataLoaded = false;

const EMP_URL = "https://raw.githubusercontent.com/bsens90-wq/hwg_main/main/data/employees.json";
const DIS_URL = "https://raw.githubusercontent.com/bsens90-wq/hwg_main/main/data/diseases.json";

const ADMIN_ACCOUNT = {
  empno: "8091768",
  password: "dcw8091"
};

const INSURANCE_COMPANIES = [
  {"company": "한화손해보험", "callCenter": "1566-8000", "fax": "0502-779-1004", "termsUrl": "https://www.hwgeneralins.com/notice/ir/product-ing01.do"},
  {"company": "삼성화재", "callCenter": "1588-5114", "fax": "0505-162-0872", "termsUrl": "https://www.samsungfire.com/vh/page/VH.HPIF0103.do"},
  {"company": "메리츠화재", "callCenter": "1566-7711", "fax": "0505-021-3400", "termsUrl": "https://www.meritzfire.com/disclosure/product-announcement/product-list.do#!/"},
  {"company": "DB손해보험", "callCenter": "1588-0100", "fax": "0505-181-4862", "termsUrl": "https://www.idbins.com/FWMAIV1534.do"},
  {"company": "KB손해보험", "callCenter": "1544-0114", "fax": "0505-136-6500", "termsUrl": "https://www.kbinsure.co.kr/CG802030001.ec"},
  {"company": "현대해상", "callCenter": "1588-5656", "fax": "0507-774-6060", "termsUrl": "https://www.hi.co.kr/serviceAction.do?view=bin/PA/03/HHPA03010M#none"},
  {"company": "롯데손해보험", "callCenter": "1588-3344", "fax": "0507-333-9999", "termsUrl": "https://www.lotteins.co.kr/web/C/D/H/cdh190.jsp"},
  {"company": "흥국화재", "callCenter": "1688-1688", "fax": "0504-800-0700", "termsUrl": "https://www.heungkukfire.co.kr/FRW/announce/insGoodsGongsiSale.do"},
  {"company": "하나손해보험", "callCenter": "1566-3000", "fax": "0505-170-0765", "termsUrl": "https://www.hanainsure.co.kr/w/disclosure/product/saleProduct"},
  {"company": "NH농협손해보험", "callCenter": "1644-9000", "fax": "0505-060-7000", "termsUrl": "https://www.nhfire.co.kr/announce/productAnnounce/retrieveInsuranceProductsAnnounce.nhfire"},
  {"company": "라이나손해보험", "callCenter": "1566-5800", "fax": "콜센터 전화 접수", "termsUrl": "https://www.lina.co.kr/disclosure/product-public-announcement/product-on-sales?key=0%3FproductState%3D01&productKind=01"},
  {"company": "AIG손해보험", "callCenter": "1544-2792", "fax": "02-2011-4607", "termsUrl": "https://www.aig.co.kr/wo/dpwot001.html?menuId=MS702"},
  {"company": "한화생명", "callCenter": "1588-6363", "fax": "콜센터 전화 접수", "termsUrl": "https://www.hanwhalife.com/main/disclosure/goods/disclosurenotice/DF_GDDN000_P10000.do?MENU_ID1=DF_GDGL000"},
  {"company": "동양생명", "callCenter": "1577-1004", "fax": "02-3289-4516", "termsUrl": "https://pbano.myangel.co.kr/paging/WE_AC_WEPAAP020100L"},
  {"company": "교보생명", "callCenter": "1588-1001", "fax": "콜센터 전화 접수", "termsUrl": "https://www.kyobo.com/dgt/web/product-official/all-product/search"},
  {"company": "삼성생명", "callCenter": "1588-3114", "fax": "콜센터 전화 접수", "termsUrl": "https://www.samsunglife.com/individual/products/disclosure/sales/PDO-PRPRI010110M"},
  {"company": "라이나생명", "callCenter": "1588-0058", "fax": "02-6944-1200", "termsUrl": "https://www.lina.co.kr/disclosure/product-public-announcement/product-on-sales?key=0%3FproductState%3D01&productKind=01"},
  {"company": "KDB생명", "callCenter": "1588-4040", "fax": "02-2669-6500", "termsUrl": "https://www.kdblife.co.kr/ajax.do?scrId=HDLMA002M02P"},
  {"company": "MG새마을금고", "callCenter": "1599-9010", "fax": "02-3016-7674", "termsUrl": "https://insure.kfcc.co.kr/#/PGE_IHJ_00003"},
  {"company": "더케이", "callCenter": "1577-3993", "fax": "02-3278-9696", "termsUrl": "https://www.ktcu.or.kr/PPW-FIC-800101"},
  {"company": "우체국", "callCenter": "1599-0100", "fax": "콜센터 전화 접수", "termsUrl": "https://mall.epostbank.go.kr/IPPSKE0000.do"},
  {"company": "수협공제", "callCenter": "1588-4119", "fax": "콜센터 전화 접수", "termsUrl": "https://www.suhyup-bank.com/"}
];

// 인수한도 데이터 로드 함수
const LIMIT_URL = "https://raw.githubusercontent.com/bsens90-wq/hwg_main/main/data/limits.json";

async function loadLimitData() {
  try {
    limitData = await loadJsonFlexible(LIMIT_URL);
  } catch(err) {
    console.error("인수한도 데이터 로드 실패:", err);
  }
}

// 상품과 플랜 목록 추출 함수
function extractProductsAndPlans() {
  const products = new Set();
  const plans = new Map();
  
  limitData.forEach(item => {
    if (item.product && item.plan) {
      products.add(item.product);
      
      if (!plans.has(item.product)) {
        plans.set(item.product, new Set());
      }
      plans.get(item.product).add(item.plan);
    }
  });
  
  return { products: Array.from(products), plans };
}

// 인수한도 테이블 생성 함수 - 개선된 버전
function generateLimitTable(selectedProduct, selectedPlan) {
  const filteredData = limitData.filter(item => 
    item.product === selectedProduct && item.plan
